<html>
<head>
    <script>
        var server_url = "http://127.0.0.1:5000";
        function callPython(methodName, data, callback) {
            var xmlhttp = new XMLHttpRequest();
            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200 && callback) {
                    callback(JSON.parse(this.responseText));
                }
            };
            var methodType = "GET";
            if (data) {
                methodType = "POST";
            }
            xmlhttp.open(methodType, server_url + "/" + methodName, true);
            xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xmlhttp.send(JSON.stringify(data));
        }
        function loadDirectory(data) {
            var dir = document.getElementById("directory");
            if (dir) {
                dir.innerText = "Directory: " + data['dirname'];
            }
            var files = document.getElementById("files");
            for (var i = 0; i < data["files"].length; i++) {
                var opt = data["files"][i];
                var el = document.createElement("option");
                el.textContent = opt;
                el.value = opt;
                files.appendChild(el);
            }
        }

        function loadEPub(data) {
            window.location.href = server_url + data['toc'];
        }
    </script>
</head>
<body onload="javascript:callPython('getFilesInEpubsDir', null, loadDirectory);">
    <p id="directory">Directory: </p>
    <p>Files: </p>
    <select id="files" size="10" onchange="javascript:callPython('openEPub', {filename: this.value}, loadEPub)">

    </select>
</body>